<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>흥국생명 스마트러닝센터 (최종 디자인 수정본)</title>
    <style>
        :root {
            /* 흥국생명 CI 기반 "모던 퍼플" 테마 */
            --primary-color: #E53699;
            --background-color: #271C42;
            --card-color: #3E3066;
            --text-primary: #F1F1F1;
            --text-secondary: #B4A9D1;
        }

        html {
            scroll-padding-top: 68px;
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-primary);
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            overflow-x: hidden;
        }

        /* 로그인 페이지 */
        #login-page {
            position: relative;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }
        .login-video-background {
            position: absolute;
            top: -10px; left: -10px;
            width: calc(100% + 20px);
            height: calc(100% + 20px);
            z-index: 1;
        }
        #login-bg-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* 2. 블러는 연하게, 밝기를 어둡게 조정 */
            filter: blur(2px) brightness(0.6);
        }
        .login-video-background::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.3); /* 가독성을 위한 어두운 오버레이 */
        }
        .login-content {
            position: relative;
            z-index: 2;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            width: 100%; height: 100%;
            text-align: center;
        }
        #login-page h1 { 
            font-size: 3.5rem; 
            font-weight: 500; 
            margin: 2.5rem 0 0 0; /* 프로필과의 간격 */
        }
        .profiles { 
            display: flex; 
            gap: 2.5rem; 
        }
        .profile-icon {
            width: 120px; height: 120px; background: linear-gradient(45deg, var(--primary-color), #8a2be2);
            border-radius: 8px; border: 2px solid transparent; display: flex;
            justify-content: center; align-items: center; font-size: 1.5rem;
            font-weight: bold; color: var(--text-primary); cursor: pointer; transition: all 0.2s ease;
            padding: 10px; box-sizing: border-box; text-align: center;
        }
        .profile:hover .profile-icon { transform: scale(1.05); border-color: var(--text-primary); }
        .sound-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 3;
            background: rgba(255,255,255,0.2);
            border: 1px solid white;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
        }
        .hidden { display: none !important; }
        
        #main-page { display: flex; }
        #menu-trigger { position: fixed; left: 0; top: 0; bottom: 0; width: 25px; z-index: 2001; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: opacity 0.3s ease; }
        #menu-trigger span { writing-mode: vertical-rl; background-color: rgba(0,0,0,0.3); padding: 15px 5px; border-radius: 0 5px 5px 0; font-size: 14px; color: var(--text-secondary); }
        #side-menu { width: 240px; background-color: #1c1430; height: 100vh; position: fixed; left: 0; top: 0; transform: translateX(-240px); transition: transform 0.3s ease; z-index: 3000; overflow-y: auto; display: flex; flex-direction: column; }
        #side-menu.active { transform: translateX(0); }
        #side-menu.active + #menu-trigger { opacity: 0; pointer-events: none; }
        .menu-header { padding: 20px 24px; font-size: 1.1rem; font-weight: bold; color: var(--primary-color); border-bottom: 1px solid var(--card-color); margin-top: 68px; }
        #side-menu nav { flex-grow: 1; }
        #side-menu nav ul { list-style: none; padding: 0; margin: 0; }
        #side-menu nav a { display: flex; align-items: center; gap: 20px; padding: 12px 24px; text-decoration: none; color: var(--text-secondary); font-size: 0.9rem; }
        #side-menu nav a:hover { background-color: var(--card-color); color: var(--text-primary); }
        
        .content-wrapper { width: 100%; }
        header { display: flex; align-items: center; justify-content: space-between; padding: 0 2%; height: 68px; background: linear-gradient(to bottom, rgba(39,28,66,0.8) 10%, rgba(39,28,66,0)); position: fixed; top: 0; width: 96%; z-index: 1000; }
        .header-left { flex: 1; display: flex; justify-content: flex-start; }
        .site-logo { font-size: 1.5rem; color: var(--primary-color); font-weight: bold; }
        .header-center { flex: 2; display: flex; justify-content: center; }
        .search-box { background-color: rgba(0,0,0,0.2); border: 1px solid var(--card-color); color: var(--text-primary); padding: 10px 15px; border-radius: 20px; width: 80%; max-width: 500px; font-size: 1rem; }
        .search-box:focus { outline: none; border-color: var(--primary-color); }
        .header-right { flex: 1; display: flex; align-items: center; justify-content: flex-end; gap: 15px; }
        .user-name, .visit-stats { font-size: 0.9rem; white-space: nowrap; }
        .user-name { font-weight: bold; }
        #current-profile-icon { width: 36px; height: 36px; border-radius: 4px; display: flex; justify-content: center; align-items: center; font-weight: bold; cursor: pointer; font-size: 1rem; background: linear-gradient(45deg, var(--primary-color), #8a2be2); }
        .mobile-menu-btn, .mobile-search-btn { display: none; }
        main { padding-top: 68px; }
        .hero-section { height: 56.25vw; max-height: 80vh; width: 100%; position: relative; overflow: hidden; }
        .hero-track { display: flex; height: 100%; transition: transform 0.5s ease-in-out; }
        .hero-slide { min-width: 100%; height: 100%; background-size: cover; background-position: center; position: relative; display: flex; align-items: center; }
        .hero-slide::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to right, rgba(39,28,66,0.8) 20%, transparent 80%); }
        .hero-info { padding-left: 4%; max-width: 40%; position: relative; z-index: 2; }
        .hero-info h2 { font-size: 3vw; margin: 0; }
        .hero-info p { font-size: 1.2vw; color: var(--text-secondary); }
        .hero-arrow { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0,0,0,0.3); color: white; border: none; width: 50px; height: 100px; cursor: pointer; z-index: 10; font-size: 3rem; opacity: 0; transition: opacity 0.3s ease; display: flex; justify-content: center; align-items: center; }
        .hero-section:hover .hero-arrow { opacity: 1; }
        .hero-arrow.arrow-prev { left: 20px; }
        .hero-arrow.arrow-next { right: 20px; }
        .content-carousel { padding: 0; margin-top: 50px; }
        .carousel-wrapper { position: relative; }
        .carousel-wrapper:hover .carousel-arrow { opacity: 1; }
        .carousel-title { font-size: 1.4rem; color: var(--primary-color); font-weight: 500; margin: 50px 0 15px; padding: 0 4%; }
        .carousel-track { display: flex; overflow-x: auto; padding: 10px 4%; scroll-behavior: smooth; scrollbar-width: none; min-height: 220px; }
        .carousel-track::-webkit-scrollbar { display: none; }
        .carousel-arrow { position: absolute; top: calc(50% + 15px); transform: translateY(-50%); background-color: rgba(0,0,0,0.3); color: white; border: none; width: 50px; height: calc(100% - 50px); cursor: pointer; z-index: 20; font-size: 2.5rem; opacity: 0; transition: opacity 0.3s ease; display: flex; justify-content: center; align-items: center; }
        .carousel-arrow.arrow-prev { left: 0; }
        .carousel-arrow.arrow-next { right: 0; }
        .content-card { min-width: 250px; margin-right: 10px; background-color: var(--card-color); border-radius: 8px; overflow: hidden; cursor: pointer; transition: transform 0.2s ease; }
        .content-card:hover { transform: scale(1.05); }
        .card-thumbnail { width: 100%; height: 140px; background-color: #5a4b8c; overflow: hidden; position: relative; }
        .card-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
        .card-info { padding: 15px; }
        .card-title { font-size: 1rem; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-meta { font-size: 0.8rem; color: var(--text-secondary); margin-top: 8px; }
        .shorts-card { min-width: 160px; }
        .shorts-card .card-thumbnail { height: 280px; }
        .progress-bar-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 5px; background-color: rgba(255, 255, 255, 0.2); display: none; }
        .progress-bar { height: 100%; background-color: var(--primary-color); border-radius: 0 2px 2px 0; }
        .play-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; pointer-events: none; }
        .continue-watching-text { color: white; background-color: rgba(0,0,0,0.7); padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: bold; border: 1px solid rgba(255,255,255,0.5); }
        .content-card.is-in-progress .play-overlay { display: flex; }
        .bookmark-btn { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.5); border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; z-index: 3; font-size: 20px; line-height: 32px; text-align: center; transition: transform 0.2s ease; }
        .bookmark-btn:hover { transform: scale(1.1); }
        .bookmark-btn::before { content: '♡'; color: white; }
        .bookmark-btn.bookmarked::before { content: '❤️'; }
        .empty-bookmark-message { color: var(--text-secondary); padding: 20px 4%; }
        footer { padding: 50px 4%; border-top: 1px solid var(--card-color); margin-top: 30px; display: flex; gap: 30px; justify-content: center; align-items: center; }
        footer a { color: var(--text-secondary); text-decoration: none; }
        #videoModal, #shortsModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; justify-content: center; align-items: center; }
        #videoModal { background: rgba(0,0,0,0.85); }
        #shortsModal { background-color: #000; z-index: 10000; }
        #videoPlayer { max-width: 90%; max-height: 80%; border-radius: 8px; background: black; }
        .close-video-btn { position: absolute; top: 20px; right: 20px; font-size: 2.5rem; background: none; color: white; border: none; cursor: pointer; }
        .shorts-viewer-container { width: 100%; height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; }
        .shorts-viewer-container::-webkit-scrollbar { display: none; }
        .shorts-video-slide { width: 100%; height: 100%; scroll-snap-align: start; position: relative; display: flex; justify-content: center; align-items: center; }
        .shorts-video-slide video { height: 100%; width: auto; max-width: 100%; aspect-ratio: 9 / 16; object-fit: contain; }
        .close-shorts-btn { position: absolute; top: 30px; left: 30px; font-size: 2rem; background: rgba(255,255,255,0.2); color: white; border: none; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; z-index: 10001; }
        #no-results-message { color: var(--text-secondary); text-align: center; padding: 50px; font-size: 1.2rem; }
        #mobile-search-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--background-color); z-index: 5000; display: none; flex-direction: column; }
        .search-overlay-header { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid var(--card-color); }
        .search-overlay-input { flex-grow: 1; background-color: var(--card-color); border: 1px solid var(--text-secondary); border-radius: 8px; padding: 12px; font-size: 1rem; color: var(--text-primary); }
        .search-overlay-close { background: none; border: none; color: var(--text-secondary); font-size: 1rem; padding: 12px; cursor: pointer; }
        .search-overlay-results { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .search-result-item { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; background-color: var(--card-color); padding: 10px; border-radius: 8px; cursor: pointer; }
        .search-result-item img { width: 100px; height: 60px; object-fit: cover; border-radius: 4px; }
        .search-result-info h3 { margin: 0 0 5px 0; font-size: 1rem; }
        .search-result-info p { margin: 0; font-size: 0.8rem; color: var(--text-secondary); }
        @media (max-width: 768px) { html { scroll-padding-top: 58px; } #login-page h1 { font-size: 8vw; } .profiles { gap: 3vw; flex-wrap: wrap; justify-content: center; padding: 0 5vw; } .profile-icon { width: 40vw; height: 40vw; font-size: 2rem; } .header-center, .header-right .user-name, .header-right .visit-stats, #current-profile-icon { display: none; } .header-left { flex: initial; } .header-right { flex: initial; } .site-logo { font-size: 1.2rem; } .mobile-menu-btn, .mobile-search-btn { display: block; font-size: 24px; background: none; color: var(--text-primary); border: none; cursor: pointer; } #menu-trigger { display: none; } .hero-info { max-width: 80%; } .hero-info h2 { font-size: 6vw; } .hero-info p { font-size: 3vw; } .hero-arrow, .carousel-arrow { display: none; } .content-card { min-width: 180px; } .shorts-card { min-width: 120px; } .carousel-title { font-size: 1.2rem; } .card-title { font-size: 0.9rem; } .card-meta { font-size: 0.7rem; } }
    </style>
</head>
<body>
    
    <div id="login-page">
        <div class="login-video-background">
           <video id="login-bg-video" loop muted playsinline>
                <source src="https://player.vimeo.com/progressive_redirect/playback/1097431073/rendition/1080p/file.mp4?loc=external&signature=16e7c65b8b67cda4d65173d0d0c178dfeca4c494ee84e633895c13df3bfc1e12" type="video/mp4">
            </video>
        </div>
        <div class="login-content">
            <div class="profiles">
                <div class="profile" onclick="showMainPage('GA')"><div class="profile-icon">GA</div></div>
                <div class="profile" onclick="showMainPage('DB')"><div class="profile-icon">DB</div></div>
                <div class="profile" onclick="showMainPage('설계사')"><div class="profile-icon">설계사</div></div>
                <div class="profile" onclick="showMainPage('공통')"><div class="profile-icon">공통과정</div></div>
            </div>
            <h1>흥국생명과 행복하세요.</h1>
        </div>
        <button id="mute-toggle-btn" class="sound-btn">🔇</button>
    </div>

    <div id="videoModal"><video id="videoPlayer" controls><source src="" type="video/mp4"></video><button onclick="closeVideo()" class="close-video-btn">×</button></div>
    <div id="shortsModal"><div class="shorts-viewer-container"></div><button onclick="closeShorts()" class="close-shorts-btn">×</button></div>
    <div id="mobile-search-overlay">
        <div class="search-overlay-header">
            <input type="search" class="search-overlay-input" placeholder="학습할 내용을 검색해 보세요...">
            <button class="search-overlay-close">취소</button>
        </div>
        <div class="search-overlay-results"></div>
    </div>

    <div id="main-page" class="hidden">
        <aside id="side-menu">
            <div class="menu-header">흥국생명 With You</div>
            <nav>
                <ul>
                    <li><a href="#main-page">🏠 홈</a></li>
                    <li><a href="#hero-section">⭐ 추천 콘텐츠</a></li>
                    <li><a href="#section-shorts">🎬 숏츠</a></li>
                    <li><a href="#section-new">✨ 신규 콘텐츠</a></li>
                    <li><a href="#section-best">🏆 베스트 콘텐츠</a></li>
                    <li><a href="#section-products">💼 상품</a></li>
                    <li><a href="#section-points">📌 오늘의 상품 포인트</a></li>
                    <li><a href="#section-knowledge">💡 지식 UP</a></li>
                    <li><a href="#section-it">💻 전산 및 언더</a></li>
                    <li><a href="#section-bookmarked">❤️ 찜한 콘텐츠</a></li>
                    <li><a href="#footer">📢 공지사항</a></li>
                    <li><a href="#footer">❓ Q&A</a></li>
                </ul>
            </nav>
        </aside>
        
        <div id="menu-trigger"><span>메뉴 보기</span></div>

        <div class="content-wrapper">
            <header>
                <div class="header-left"><div class="site-logo">흥국생명 With You</div></div>
                <div class="header-center"><input type="search" placeholder="학습할 내용을 검색해 보세요..." class="search-box"></div>
                <div class="header-right">
                    <span class="user-name">김화현님</span>
                    <span class="visit-stats">📊 이달의 방문 : 10회</span>
                    <div id="current-profile-icon" title="프로필 변경"></div>
                    <button class="mobile-search-btn">🔍</button>
                    <button class="mobile-menu-btn">☰</button>
                </div>
            </header>

            <main>
                <section id="hero-section" class="hero-section">
                    <div class="hero-track">
                        <div class="hero-slide" style="background-image: url('https://picsum.photos/1600/900?random=1');"><div class="hero-info"><h2>필수 시청! 7월 개정 상품 완전정복</h2><p>달라진 보장 내용과 핵심 판매 포인트를 영상 하나로 끝내세요.</p></div></div>
                        <div class="hero-slide" style="background-image: url('https://picsum.photos/1600/900?random=2');"><div class="hero-info"><h2>고객 감동을 이끄는 상담 노하우</h2><p>평범한 상담을 넘어 고객의 마음을 사로잡는 비결을 공개합니다.</p></div></div>
                        <div class="hero-slide" style="background-image: url('https://picsum.photos/1600/900?random=3');"><div class="hero-info"><h2>신입을 위한 영업 성공 가이드</h2><p>이제 막 시작하는 당신을 위해 준비했습니다. A부터 Z까지!</p></div></div>
                    </div>
                    <button class="hero-arrow arrow-prev">‹</button>
                    <button class="hero-arrow arrow-next">›</button>
                </section>
                
                <div class="content-carousel">
                    <div id="section-shorts" class="carousel-wrapper"><h2 class="carousel-title">숏츠 모음</h2><div class="carousel-track" data-track-id="shorts"></div><button class="carousel-arrow arrow-prev">‹</button><button class="carousel-arrow arrow-next">›</button></div>
                    <div id="section-new" class="carousel-wrapper"><h2 class="carousel-title">신규 콘텐츠</h2><div class="carousel-track" data-track-id="new"></div><button class="carousel-arrow arrow-prev">‹</button><button class="carousel-arrow arrow-next">›</button></div>
                    <div id="section-best" class="carousel-wrapper"><h2 class="carousel-title">베스트 콘텐츠</h2><div class="carousel-track" data-track-id="best"></div><button class="carousel-arrow arrow-prev">‹</button><button class="carousel-arrow arrow-next">›</button></div>
                    <div id="section-products" class="carousel-wrapper"><h2 class="carousel-title">상품</h2><div class="carousel-track" data-track-id="products"></div><button class="carousel-arrow arrow-prev">‹</button><button class="carousel-arrow arrow-next">›</button></div>
                    <div id="section-points" class="carousel-wrapper"><h2 class="carousel-title">오늘의 상품 포인트</h2><div class="carousel-track" data-track-id="points"></div><button class="carousel-arrow arrow-prev">‹</button><button class="carousel-arrow arrow-next">›</button></div>
                    <div id="section-knowledge" class="carousel-wrapper"><h2 class="carousel-title">지식 UP</h2><div class="carousel-track" data-track-id="knowledge"></div><button class="carousel-arrow arrow-prev">‹</button><button class="carousel-arrow arrow-next">›</button></div>
                    <div id="section-it" class="carousel-wrapper"><h2 class="carousel-title">전산 및 언더</h2><div class="carousel-track" data-track-id="it"></div><button class="carousel-arrow arrow-prev">‹</button><button class="carousel-arrow arrow-next">›</button></div>
                    <div id="section-bookmarked" class="carousel-wrapper"><h2 class="carousel-title">찜한 콘텐츠</h2><div class="carousel-track" data-track-id="bookmarked"><p class="empty-bookmark-message">아직 찜한 콘텐츠가 없습니다. ❤️ 아이콘을 눌러 원하는 콘텐츠를 추가해 보세요!</p></div><button class="carousel-arrow arrow-prev">‹</button><button class="carousel-arrow arrow-next">›</button></div>
                </div>
                
                <div id="no-results-message" class="hidden">
                    <p style="font-size: 2rem; margin: 0;">🤔</p>
                    <p>검색 결과가 없습니다.</p>
                </div>

                <footer id="footer">
                    <a href="#">공지사항</a>
                    <a href="#">Q&A</a>
                </footer>
            </main>
        </div>
    </div>

    <script>
        let allCardsData = {}; let bookmarkedItems = new Set();
        function showMainPage(profileName) { document.getElementById('login-page').style.display = 'none'; document.getElementById('main-page').classList.remove('hidden'); const profileIconInHeader = document.getElementById('current-profile-icon'); if (profileIconInHeader) { profileIconInHeader.textContent = profileName.substring(0, 2); } }
        function returnToLogin() { document.getElementById('main-page').classList.add('hidden'); document.getElementById('login-page').style.display = 'flex'; const bgVideo = document.getElementById('login-bg-video'); if(bgVideo) bgVideo.play().catch(e => {}); }
        const sideMenu = document.getElementById('side-menu'); if (window.innerWidth > 768) { const menuTrigger = document.getElementById('menu-trigger'); const mainContent = document.querySelector('.content-wrapper'); menuTrigger.addEventListener('mouseenter', () => sideMenu.classList.add('active')); sideMenu.addEventListener('mouseleave', () => sideMenu.classList.remove('active')); mainContent.addEventListener('mouseenter', () => { if (sideMenu.classList.contains('active')) sideMenu.classList.remove('active'); });
        } else { const mobileMenuBtn = document.querySelector('.mobile-menu-btn'); mobileMenuBtn.addEventListener('click', () => sideMenu.classList.toggle('active')); }
        document.querySelectorAll('#side-menu a[href^="#"]').forEach(anchor => { anchor.addEventListener('click', function (e) { e.preventDefault(); const targetId = this.getAttribute('href'); if (!targetId || targetId === '#') { window.scrollTo({ top: 0, behavior: 'smooth' }); } else { const targetElement = document.querySelector(targetId); if (targetElement) { targetElement.scrollIntoView({ behavior: 'smooth' }); } } document.getElementById('side-menu').classList.remove('active'); }); });

     // 영상 팝업 기능
    function openVideo(videoUrl, startTime = 0) {
        const modal = document.getElementById('videoModal');
        const player = document.getElementById('videoPlayer');
        player.src = videoUrl;
        player.addEventListener('canplay', function onCanPlay() {
            player.currentTime = startTime;
            setTimeout(() => player.play(), 50);
            player.removeEventListener('canplay', onCanPlay);
        }, { once: true });
        modal.style.display = 'flex';
    }
  
    function closeVideo() {
        const modal = document.getElementById('videoModal');
        const player = document.getElementById('videoPlayer');
        modal.style.display = 'none';
        player.pause();
        player.src = '';
    }

  // 숏츠 재생 기능
    const shortsModal = document.getElementById('shortsModal');
    const shortsContainer = document.querySelector('.shorts-viewer-container');
  const sampleShortsVideos = [
    'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
    'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4',
    'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4'
];
        let shortsObserver;

function openShorts(startIndex = 0) {
    if (!shortsContainer || !shortsModal) return;

         shortsContainer.innerHTML = '';

    // 숏츠 영상들 생성
    sampleShortsVideos.forEach((src, index) => {
        const slide = document.createElement('div');
        slide.className = 'shorts-video-slide';
        slide.style.scrollSnapAlign = 'start';

        const video = document.createElement('video');
        video.src = src;
        video.loop = true;
        video.playsInline = true;
        video.muted = true;
        video.autoplay = true;
        video.controls = false;
        video.setAttribute('preload', 'metadata');
        video.style.height = '100%';
        video.style.width = 'auto';
        video.style.maxWidth = '100%';
        video.style.aspectRatio = '9 / 16';
        video.style.objectFit = 'contain';

        slide.appendChild(video);
        shortsContainer.appendChild(slide);
    });

     // 모달 열기
    shortsModal.style.display = 'block';
    document.body.style.overflow = 'hidden';

    // 스크롤 위치 이동 + 관찰자 설정
    setTimeout(() => {
        shortsContainer.scrollTo({
            top: startIndex * shortsContainer.clientHeight,
            behavior: 'instant'
        });
        setupShortsObserver();
    }, 50);
}

   function closeShorts() {
        if (!shortsModal) return;
        shortsModal.style.display = 'none';
        document.body.style.overflow = '';
        if (shortsContainer) {
            shortsContainer.querySelectorAll('video').forEach(v => v.pause());
            shortsContainer.innerHTML = '';
        }
        if (shortsObserver) shortsObserver.disconnect();
    }

  function setupShortsObserver() {
    if (shortsObserver) shortsObserver.disconnect();

    const options = {
        root: shortsContainer,
        threshold: 0.8
    };

   
    shortsObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const video = entry.target.querySelector('video');
            if (entry.isIntersecting) {
                setTimeout(() => {
                    video.play().catch(() => {});
                }, 50);
            } else {
                video.pause();
                video.currentTime = 0;
            }
        });
    }, options);

    shortsContainer.querySelectorAll('.shorts-video-slide').forEach(slide => {
        shortsObserver.observe(slide);
    });
}

        document.addEventListener('DOMContentLoaded', () => {
            const bgVideo = document.getElementById('login-bg-video');
            if(bgVideo) { bgVideo.play().catch(error => {}); }
            const profileChangeBtn = document.getElementById('current-profile-icon');
            if(profileChangeBtn) { profileChangeBtn.addEventListener('click', returnToLogin); }
            const muteBtn = document.getElementById('mute-toggle-btn');
            if(muteBtn && bgVideo) { muteBtn.addEventListener('click', () => { bgVideo.muted = !bgVideo.muted; muteBtn.innerHTML = bgVideo.muted ? '🔇' : '🔊'; }); }
            const heroTrack = document.querySelector('.hero-track');
            if (heroTrack) { heroTrack.innerHTML = `<div class="hero-slide" style="background-image: url('https://picsum.photos/1600/900?random=1');"><div class="hero-info"><h2>필수 시청! 7월 개정 상품 완전정복</h2><p>달라진 보장 내용과 핵심 판매 포인트를 영상 하나로 끝내세요.</p></div></div><div class="hero-slide" style="background-image: url('https://picsum.photos/1600/900?random=2');"><div class="hero-info"><h2>고객 감동을 이끄는 상담 노하우</h2><p>평범한 상담을 넘어 고객의 마음을 사로잡는 비결을 공개합니다.</p></div></div><div class="hero-slide" style="background-image: url('https://picsum.photos/1600/900?random=3');"><div class="hero-info"><h2>신입을 위한 영업 성공 가이드</h2><p>이제 막 시작하는 당신을 위해 준비했습니다. A부터 Z까지!</p></div></div>`; const slides = Array.from(heroTrack.children); const nextButton = document.querySelector('.hero-arrow.arrow-next'); const prevButton = document.querySelector('.hero-arrow.arrow-prev'); if (slides && slides.length > 0 && nextButton && prevButton) { let currentIndex = 0, intervalId = null; const moveToSlide = (targetIndex) => { if (heroTrack) heroTrack.style.transform = `translateX(-${targetIndex * 100}%)`; currentIndex = targetIndex; }; const startAutoSlide = () => { stopAutoSlide(); intervalId = setInterval(() => { const nextIndex = (currentIndex + 1) % slides.length; moveToSlide(nextIndex); }, 5000); }; const stopAutoSlide = () => clearInterval(intervalId); nextButton.addEventListener('click', () => { stopAutoSlide(); const nextIndex = (currentIndex + 1) % slides.length; moveToSlide(nextIndex); startAutoSlide(); }); prevButton.addEventListener('click', () => { stopAutoSlide(); const prevIndex = (currentIndex - 1 + slides.length) % slides.length; moveToSlide(prevIndex); startAutoSlide(); }); heroTrack.addEventListener('mouseenter', stopAutoSlide); heroTrack.addEventListener('mouseleave', startAutoSlide); startAutoSlide(); } }
            
            function generateCards(trackId, count, options) { const track = document.querySelector(`[data-track-id="${trackId}"]`); if (!track) return; let cardsHTML = ''; for (let i = 1; i <= count; i++) { const videoId = `${trackId}-${i}`; const isBookmarked = bookmarkedItems.has(videoId); const progress = Math.random() * 80 + 10; const isPartial = Math.random() > 0.6; const progressTime = isPartial ? 30 : 0; const cardClass = `${options.isShorts ? 'shorts-card' : ''} ${isPartial ? 'is-in-progress' : ''}`; const imgSrc = options.isShorts ? `https://picsum.photos/160/280?random=${i + options.seed}` : `https://picsum.photos/250/140?random=${i + options.seed}`; const cardHTML = `<div class="content-card ${cardClass}" data-video-id="${videoId}" data-progress="${progressTime}"><div class="card-thumbnail"><img src="${imgSrc}" alt="${options.title} 썸네일"><button class="bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" aria-label="찜하기"></button><div class="play-overlay"><span class="continue-watching-text">이어보기</span></div><div class="progress-bar-container"><div class="progress-bar" style="width:${progress}%"></div></div></div><div class="card-info"><div class="card-title">${options.title} #${i}</div>${!options.isShorts ? `<div class="card-meta">${options.instructor} · 조회수 ${Math.floor(Math.random()*20)}.${Math.floor(Math.random()*9)}만회</div>` : ''}</div></div>`; cardsHTML += cardHTML; allCardsData[videoId] = cardHTML; } track.innerHTML = cardsHTML; }
            function renderBookmarkedCarousel() { const track = document.querySelector(`[data-track-id="bookmarked"]`); if (!track) return; if (bookmarkedItems.size === 0) { track.innerHTML = `<p class="empty-bookmark-message">아직 찜한 콘텐츠가 없습니다. ❤️ 아이콘을 눌러 원하는 콘텐츠를 추가해 보세요!</p>`; return; } let cardsHTML = ''; bookmarkedItems.forEach(videoId => { if(allCardsData[videoId]) cardsHTML += allCardsData[videoId]; }); track.innerHTML = cardsHTML; attachCardClickListeners(track); }
            const allTracks = [ { id: 'shorts', options: { isShorts: true, title: '숏츠 콘텐츠', seed: 10 } }, { id: 'new', options: { isShorts: false, title: '새로운 콘텐츠', instructor: '김흥국 강사', seed: 25 } }, { id: 'best', options: { isShorts: false, title: '베스트 콘텐츠', instructor: '박생명 강사', seed: 40 } }, { id: 'products', options: { isShorts: false, title: '금융 상품', instructor: '이상품 강사', seed: 55 } }, { id: 'points', options: { isShorts: false, title: '오늘의 상품 포인트', instructor: '운영자', seed: 70 } }, { id: 'knowledge', options: { isShorts: false, title: '영업 노하우', instructor: '박지식 강사', seed: 85 } }, { id: 'it', options: { isShorts: false, title: '시스템 가이드', instructor: '지원팀', seed: 100 } } ];
            allTracks.forEach(trackInfo => generateCards(trackInfo.id, 15, trackInfo.options));
            function attachCardClickListeners(parentElement) { parentElement.querySelectorAll('.content-card').forEach(card => { if (card.dataset.listenerAttached === 'true') return; card.dataset.listenerAttached = 'true'; const bookmarkBtn = card.querySelector('.bookmark-btn'); if (bookmarkBtn) { bookmarkBtn.addEventListener('click', (e) => { e.stopPropagation(); const videoId = card.dataset.videoId; if (bookmarkedItems.has(videoId)) { bookmarkedItems.delete(videoId); e.target.classList.remove('bookmarked'); } else { bookmarkedItems.add(videoId); e.target.classList.add('bookmarked'); } renderBookmarkedCarousel(); }); } card.addEventListener('click', () => { if (!card.classList.contains('shorts-card')) { const sampleVideos = ['https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4']; const progressTime = parseFloat(card.dataset.progress) || 0; openVideo(sampleVideos[Math.floor(Math.random() * sampleVideos.length)], progressTime); } else { const allShortsOnPage = Array.from(document.querySelectorAll('#section-shorts .shorts-card')); const clickedIndex = allShortsOnPage.indexOf(card); openShorts(clickedIndex % sampleShortsVideos.length); } }); }); }
            attachCardClickListeners(document.querySelector('.content-carousel'));
            const searchInput = document.querySelector('.search-box'); const noResultsMessage = document.getElementById('no-results-message'); const contentCarousel = document.querySelector('.content-carousel');
            searchInput.addEventListener('input', (e) => { const query = e.target.value.toLowerCase().trim(); let totalMatches = 0; allTracks.forEach(trackInfo => { const track = document.querySelector(`[data-track-id="${trackInfo.id}"]`); const wrapper = track.closest('.carousel-wrapper'); let cardsHTML = ''; let matchesInThisCarousel = 0; for (const videoId in allCardsData) { if (videoId.startsWith(trackInfo.id)) { const cardData = allCardsData[videoId]; if (cardData.toLowerCase().includes(query)) { cardsHTML += cardData; matchesInThisCarousel++; } } } track.innerHTML = cardsHTML; if(matchesInThisCarousel > 0) { wrapper.style.display = ''; totalMatches++; } else { wrapper.style.display = 'none'; } }); document.querySelector('[data-track-id="bookmarked"]').closest('.carousel-wrapper').style.display = (query) ? 'none' : ''; noResultsMessage.style.display = (totalMatches === 0 && query) ? 'block' : 'none'; attachCardClickListeners(contentCarousel); });
            const mobileSearchBtn = document.querySelector('.mobile-search-btn'); const searchOverlay = document.getElementById('mobile-search-overlay'); const searchOverlayInput = document.querySelector('.search-overlay-input'); const searchOverlayClose = document.querySelector('.search-overlay-close'); const searchOverlayResults = document.querySelector('.search-overlay-results');
            mobileSearchBtn.addEventListener('click', () => { searchOverlay.style.display = 'flex'; document.body.style.overflow = 'hidden'; });
            searchOverlayClose.addEventListener('click', () => { searchOverlay.style.display = 'none'; document.body.style.overflow = ''; });
            searchOverlayInput.addEventListener('input', (e) => { const query = e.target.value.toLowerCase().trim(); let resultsHTML = ''; if (query) { for (const videoId in allCardsData) { const cardData = allCardsData[videoId]; if (cardData.toLowerCase().includes(query)) { const tempDiv = document.createElement('div'); tempDiv.innerHTML = cardData; const cardElement = tempDiv.firstElementChild; const title = cardElement.querySelector('.card-title').textContent; const meta = cardElement.querySelector('.card-meta')?.textContent || '숏츠 콘텐츠'; const imgSrc = cardElement.querySelector('img').src; resultsHTML += `<div class="search-result-item" data-video-id="${videoId}"><img src="${imgSrc}" alt="${title}"><div class="search-result-info"><h3>${title}</h3><p>${meta}</p></div></div>`; } } } searchOverlayResults.innerHTML = resultsHTML || (query ? '<p style="text-align:center;">검색 결과가 없습니다.</p>' : ''); });
            searchOverlayResults.addEventListener('click', (e) => { const resultItem = e.target.closest('.search-result-item'); if(resultItem) { const videoId = resultItem.dataset.videoId; document.querySelector(`[data-video-id='${videoId}']`).click(); searchOverlay.style.display = 'none'; document.body.style.overflow = ''; } });
            document.querySelectorAll('.carousel-wrapper').forEach(wrapper => { const track = wrapper.querySelector('.carousel-track'); const prevButton = wrapper.querySelector('.arrow-prev'); const nextButton = wrapper.querySelector('.arrow-next'); if (track && prevButton && nextButton) { nextButton.addEventListener('click', () => { track.scrollBy({ left: track.clientWidth * 0.8, behavior: 'smooth' }); }); prevButton.addEventListener('click', () => { track.scrollBy({ left: -track.clientWidth * 0.8, behavior: 'smooth' }); }); } });
        });
    </script>
</body>
</html>